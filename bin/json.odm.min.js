"use strict";function JsonOdm(){var o=this;this.sources={},this.selectedSource={},this.addSource=function(t,n,e){"object"==typeof n&&("undefined"==typeof o.sources[t]&&(o.sources[t]=n),e&&(o.selectedSource=n))},this.selectSource=function(t){"undefined"!=typeof o.sources[t]&&(o.selectedSource=o.sources[t])}}var root="undefined"!=typeof window?window:global,odm=new JsonOdm;root.jsonOdm||(root.jsonOdm=odm),"undefined"!=typeof module&&module.exports&&(module.exports=odm),jsonOdm.Util=function(){},jsonOdm.Util.prototype.isArray=function(o){return Array.isArray?Array.isArray(o):"[object Array]"===Object.prototype.toString.call(o)},jsonOdm.Util.prototype.is=function(o,t){t="string"==typeof t?[t]:t;var n=Object.prototype.toString.call(o);n=n.substring(8,n.length-1).toLowerCase();for(var e=0;e<t.length;e++){var r=t[e].toLowerCase();if("array"==r&&this.isArray(o))return!0;if(r==n)return!0;if(typeof o==r)return!0}return!1},jsonOdm.Util.prototype.objectKeys=Object.keys||function(){var o=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],e=n.length;return function(r){if("object"!=typeof r&&("function"!=typeof r||null===r))throw new TypeError("Object.keys called on non-object");var i,s,u=[];for(i in r)o.call(r,i)&&u.push(i);if(t)for(s=0;e>s;s++)o.call(r,n[s])&&u.push(n[s]);return u}}(),jsonOdm.Util.prototype.branch=function(o,t){function n(){if(arguments&&arguments.length&&this){var o=this[arguments[0]];return o?n.apply(o,Array.prototype.slice.call(arguments,1)):o}return this}return n.apply(o,t)},jsonOdm.util=new jsonOdm.Util,jsonOdm.Geo=function(){},jsonOdm.Geo.detectAsGeometry=function(o){if(!o.type)if(jsonOdm.util.isArray(o)&&2==o.length&&!jsonOdm.util.isArray(o[0]))o=new jsonOdm.Geo.Point(o);else if(jsonOdm.util.isArray(o)&&4==o.length&&!jsonOdm.util.isArray(o[0]))o=new jsonOdm.Geo.BoundaryBox(o);else if(jsonOdm.util.isArray(o)&&o.length>=1&&jsonOdm.util.isArray(o[0])&&2==o[0].length&&!jsonOdm.util.isArray(o[0][0]))o=new jsonOdm.Geo.LineString(o);else if(jsonOdm.util.isArray(o)&&o.length>=1&&jsonOdm.util.isArray(o[0])&&o[0].length>=1&&jsonOdm.util.isArray(o[0][0])&&2==o[0][0].length&&!jsonOdm.util.isArray(o[0][0][0]))o=new jsonOdm.Geo.Polygon(o);else{if(!(jsonOdm.util.isArray(o)&&o.length>=1&&jsonOdm.util.isArray(o[0])&&o[0].length>=1&&jsonOdm.util.isArray(o[0][0])&&o[0][0].length>=1&&jsonOdm.util.isArray(o[0][0][0])&&2==o[0][0][0].length)||jsonOdm.util.isArray(o[0][0][0][0]))return!1;o=new jsonOdm.Geo.MultiPolygon(o)}return o},jsonOdm.Geo.FeatureCollection=function(o,t){this.type="FeatureCollection",this.features=o||[],t&&(this.bbox=t)},jsonOdm.Geo.Feature=function(o,t,n,e){this.geometry=o||{},t&&(this.properties=t),n&&(this.bbox=n),e&&(this.id=e)},jsonOdm.Geo.BoundaryBox=function(o){var t=Object.create(Array.prototype);return t=Array.apply(t)||t,jsonOdm.util.isArray(o)?(t[0]=o[0],t[1]=o[1],t[2]=o[2],t[3]=o[3]):(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t},jsonOdm.Geo.BoundaryBox.within=function(o,t){return jsonOdm.util.isArray(o)&&4==o.length?jsonOdm.Geo.Polygon.within(new jsonOdm.Geo.Polygon([[[o[0],o[1]],[o[2],o[1]],[o[2],o[3]],[o[0],o[3]],[o[0],o[1]]]]),t):!1},jsonOdm.Geo.Point=function(o,t){this.type="Point",this.coordinates=o,t&&(this.bbox=t)},jsonOdm.Geo.Point.within=function(o,t){var n,e;if(!o.coordinates)return!1;if("Point"==t.type)return t.coordinates[0]==o.coordinates[0]&&t.coordinates[1]==o.coordinates[1];if("MultiPoint"==t.type||"LineString"==t.type){for(n=0;t.coordinates&&n<t.coordinates.length;n++)if(t.coordinates[n][0]==o.coordinates[0]&&t.coordinates[n][1]==o.coordinates[1])return!0;return!1}if("MultiLineString"==t.type){for(n=0;t.coordinates&&n<t.coordinates.length;n++)for(e=0;t.coordinates[n]&&e<t.coordinates[n].length;e++)if(t.coordinates[n][e][0]==o.coordinates[0]&&t.coordinates[n][e][1]==o.coordinates[1])return!0;return!1}if("Polygon"==t.type)return jsonOdm.Geo.pointWithinPolygon(o.coordinates,t.coordinates?t.coordinates[0]:null);if("MultiPolygon"==t.type){for(n=0;t.coordinates&&n<t.coordinates.length;n++)if(jsonOdm.Geo.pointWithinPolygon(o.coordinates,t.coordinates[n]?t.coordinates[n][0]:null))return!0;return!1}if("GeometryCollection"==t.type&&jsonOdm.util.isArray(t.geometries)){for(n=0;n<t.geometries.length;n++)if(jsonOdm.Geo.Point.within(o,t.geometries[n]))return!0;return!1}return jsonOdm.Geo.pointWithinBounds(o.coordinates,t)},jsonOdm.Geo.MultiPoint=function(o,t){this.type="MultiPoint",this.coordinates=o,t&&(this.bbox=t)},jsonOdm.Geo.MultiPoint.within=function(o,t){var n,e,r,i;if(!o.coordinates||!jsonOdm.util.isArray(o.coordinates))return!1;if("Point"==t.type)return 1==o.coordinates.length&&o.coordinates[0][0]==t.coordinates[0]&&o.coordinates[0][1]==t.coordinates[1];if("MultiPoint"==t.type){for(n=0;t.coordinates&&n<t.coordinates.length;n++){for(i=!1,e=0;o.coordinates&&e<o.coordinates.length;e++)i=i||t.coordinates[n][0]==o.coordinates[e][0]&&t.coordinates[n][1]==o.coordinates[e][1];if(!i)return!1}return!0}if("LineString"==t.type){for(r=0;o.coordinates&&r<o.coordinates.length;r++)if(!jsonOdm.Geo.pointWithinLineString(o.coordinates[r],t.coordinates))return!1;return!0}if("MultiLineString"==t.type){for(r=0;o.coordinates&&r<o.coordinates.length;r++){for(i=!1,n=0;t.coordinates&&n<t.coordinates.length;n++)if(jsonOdm.Geo.pointWithinLineString(o.coordinates[r],t.coordinates[n])){i=!0;break}if(!i)return!1}return!0}if("Polygon"==t.type){for(n=0;o.coordinates&&n<o.coordinates.length;n++)if(!jsonOdm.Geo.pointWithinPolygon(o.coordinates[n],t.coordinates?t.coordinates[0]:null))return!1;return!0}if("MultiPolygon"==t.type){for(e=0;o.coordinates&&e<o.coordinates.length;e++){for(i=!1,n=0;t.coordinates&&n<t.coordinates.length;n++)if(jsonOdm.Geo.pointWithinPolygon(o.coordinates[e],t.coordinates[n]?t.coordinates[n][0]:null)){i=!0;break}if(!i)return!1}return!0}if("GeometryCollection"==t.type&&jsonOdm.util.isArray(t.geometries)){for(n=0;n<t.geometries.length;n++)if(jsonOdm.Geo.MultiPoint.within(o,t.geometries[n]))return!0;return!1}for(n=0;n<o.coordinates.length;n++)if(!jsonOdm.Geo.pointWithinBounds(o.coordinates[n],t))return!1;return!0},jsonOdm.Geo.LineString=function(o,t){this.type="LineString",this.coordinates=o,t&&(this.bbox=t)},jsonOdm.Geo.LineString.within=function(o,t){var n,e;if(!o.coordinates||!jsonOdm.util.isArray(o.coordinates))return!1;if("Point"==t.type||"MultiPoint"==t.type)return!1;if("LineString"==t.type)return jsonOdm.Geo.lineStringWithinLineString(o.coordinates,t.coordinates);if("MultiLineString"==t.type){for(n=0;t.coordinates&&n<t.coordinates.length;n++)if(jsonOdm.Geo.lineStringWithinLineString(o.coordinates,t.coordinates[n]))return!0;return!1}if("Polygon"==t.type){for(n=0;o.coordinates&&n<o.coordinates.length-1;n++)if(!jsonOdm.Geo.edgeWithinPolygon([o.coordinates[n],o.coordinates[n+1]],t.coordinates[0]))return!1;return!0}if("MultiPolygon"==t.type){for(n=0;t.coordinates&&n<t.coordinates.length;n++)for(e=0;o.coordinates&&e<o.coordinates.length-1;e++)if(jsonOdm.Geo.edgeWithinPolygon([o.coordinates[e],o.coordinates[e+1]],t.coordinates[n][0])&&e+1==o.coordinates.length-1)return!0;return!1}if("GeometryCollection"==t.type&&jsonOdm.util.isArray(t.geometries)){for(n=0;n<t.geometries.length;n++)if(jsonOdm.Geo.LineString.within(o,t.geometries[n]))return!0;return!1}for(n=0;n<o.coordinates.length;n++)if(!jsonOdm.Geo.pointWithinBounds(o.coordinates[n],t))return!1;return!0},jsonOdm.Geo.MultiLineString=function(o,t){this.type="MultiLineString",this.coordinates=o,t&&(this.bbox=t)},jsonOdm.Geo.MultiLineString.within=function(o,t){var n,e,r,i;if(!o.coordinates||!jsonOdm.util.isArray(o.coordinates))return!1;if("Point"==t.type||"MultiPoint"==t.type)return!1;if("LineString"==t.type){for(n=0;o.coordinates&&n<o.coordinates.length;n++)if(!jsonOdm.Geo.lineStringWithinLineString(o.coordinates[n],t.coordinates))return!1;return!0}if("MultiLineString"==t.type){for(e=0;o.coordinates&&e<o.coordinates.length;e++){for(i=!1,n=0;t.coordinates&&n<t.coordinates.length;n++)if(jsonOdm.Geo.lineStringWithinLineString(o.coordinates[e],t.coordinates[n])){i=!0;break}if(!i)return!1}return!0}if("Polygon"==t.type){for(n=0;o.coordinates&&n<o.coordinates.length;n++)for(e=0;o.coordinates&&e<o.coordinates[n].length-1;e++)if(!jsonOdm.Geo.edgeWithinPolygon([o.coordinates[n][e],o.coordinates[n][e+1]],t.coordinates[0]))return!1;return!0}if("MultiPolygon"==t.type){for(e=0;o.coordinates&&e<o.coordinates.length;e++){for(i=!1,n=0;t.coordinates&&n<t.coordinates.length;n++)for(r=0;o.coordinates[e]&&r<o.coordinates[e].length-1;r++)if(jsonOdm.Geo.edgeWithinPolygon([o.coordinates[e][r],o.coordinates[e][r+1]],t.coordinates[n][0])&&r+1==o.coordinates[e].length-1){i=!0;break}if(!i)return!1}return!0}if("GeometryCollection"==t.type&&jsonOdm.util.isArray(t.geometries)){for(n=0;n<t.geometries.length;n++)if(jsonOdm.Geo.MultiLineString.within(o,t.geometries[n]))return!0;return!1}for(n=0;n<o.coordinates.length;n++)for(e=0;e<o.coordinates[n].length;e++)if(!jsonOdm.Geo.pointWithinBounds(o.coordinates[n][e],t))return!1;return!0},jsonOdm.Geo.Polygon=function(o,t){this.type="Polygon",this.coordinates=o,t&&(this.bbox=t)},jsonOdm.Geo.Polygon.within=function(o,t){var n,e;if(!o.coordinates||!jsonOdm.util.isArray(o.coordinates))return!1;if("Point"==t.type||"MultiPoint"==t.type||"LineString"==t.type||"MultiLineString"==t.type)return!1;if("Polygon"==t.type){for(n=0;o.coordinates[0]&&n<o.coordinates[0].length-1;n++)if(!jsonOdm.Geo.edgeWithinPolygon([o.coordinates[0][n],o.coordinates[0][n+1]],t.coordinates[0]))return!1;return!0}if("MultiPolygon"==t.type){for(n=0;t.coordinates&&n<t.coordinates.length-1;n++)for(e=0;o.coordinates[0]&&e<o.coordinates[0].length-1;e++)if(jsonOdm.Geo.edgeWithinPolygon([o.coordinates[0][e],o.coordinates[0][e+1]],t.coordinates[n][0])&&e+1==o.coordinates[0].length-1)return!0;return!1}if("GeometryCollection"==t.type&&jsonOdm.util.isArray(t.geometries)){for(n=0;n<t.geometries.length;n++)if(jsonOdm.Geo.Polygon.within(o,t.geometries[n]))return!0;return!1}for(n=0;o.coordinates[0]&&n<o.coordinates[0].length;n++)if(!jsonOdm.Geo.pointWithinBounds(o.coordinates[0][n],t))return!1;return!0},jsonOdm.Geo.MultiPolygon=function(o,t){this.type="MultiPolygon",this.coordinates=o,t&&(this.bbox=t)},jsonOdm.Geo.MultiPolygon.within=function(o,t){var n,e,r,i;if(!polygon.coordinates||!jsonOdm.util.isArray(polygon.coordinates))return!1;if("Point"==t.type||"MultiPoint"==t.type||"LineString"==t.type||"MultiLineString"==t.type)return!1;if("Polygon"==t.type){for(n=0;o.coordinates&&n<o.coordinates.length;n++)for(e=0;e<o.coordinates[n][0].length-1;e++)if(!jsonOdm.Geo.edgeWithinPolygon([o.coordinates[n][0][e],o.coordinates[n][0][e+1]],t.coordinates[0]))return!1;return!0}if("MultiPolygon"==t.type){for(n=0;polygon.coordinates&&n<polygon.coordinates.length;n++){for(i=!1,e=0;t.coordinates&&e<t.coordinates.length-1;e++)for(r=0;polygon.coordinates[n][0]&&r<polygon.coordinates[n][0].length-1;r++)if(jsonOdm.Geo.edgeWithinPolygon([polygon.coordinates[n][0][r],polygon.coordinates[n][0][r+1]],t.coordinates[e][0])&&r+1==polygon.coordinates[n][0].length-1){i=!0;break}if(!i)return!1}return!0}if("GeometryCollection"==t.type&&jsonOdm.util.isArray(t.geometries)){for(n=0;n<t.geometries.length;n++)if(jsonOdm.Geo.MultiPolygon.within(o,t.geometries[n]))return!0;return!1}for(n=0;n<o.coordinates.length;n++)for(e=0;e<o.coordinates[n][0].length;e++)if(!jsonOdm.Geo.pointWithinBounds(o.coordinates[n][0][e],t))return!1;return!0},jsonOdm.Geo.GeometryCollection=function(o,t){this.type="GeometryCollection",this.geometries=o,t&&(this.bbox=t)},jsonOdm.Geo.GeometryCollection.within=function(o,t){if(!jsonOdm.util.isArray(o.geometries)||!o.geometries.length||!t.type)return!1;for(var n=0;n<o.geometries.length;n++)if(jsonOdm.Geo[o.geometries[n].type]&&jsonOdm.Geo[o.geometries[n].type].within&&!jsonOdm.Geo[o.geometries[n].type].within(o.geometries[n],t))return!1},jsonOdm.Geo.pointWithinPolygon=function(o,t){if(!(jsonOdm.util.isArray(o)&&jsonOdm.util.isArray(t)&&t.length>2))return!1;var n=0;(t[0][0]!=t[t.length-1][0]||t[0][1]!=t[t.length-1][1])&&(t=t.concat([t[0]]));for(var e=0;e<t.length-1;e++){if(t[e][0]==o[0]&&t[e][1]==o[1])return!0;t[e][0]<o[0]&&t[e+1][0]<o[0]||t[e][1]<o[1]&&t[e+1][1]<o[1]||t[e][1]>o[1]&&t[e+1][1]>o[1]||(t[e][0]-t[e+1][0])*((o[1]-t[e+1][1])/(t[e][1]-t[e+1][1]))+t[e+1][0]>=o[1]&&n++}return n%2==1},jsonOdm.Geo.edgeWithinPolygon=function(o,t){if(!(jsonOdm.util.isArray(o)&&2==o.length&&jsonOdm.util.isArray(t)&&t.length>2))return!1;if((t[0][0]!=t[t.length-1][0]||t[0][1]!=t[t.length-1][1])&&(t=t.concat([t[0]])),!jsonOdm.Geo.pointWithinPolygon(o[0],t)||!jsonOdm.Geo.pointWithinPolygon(o[1],t))return!1;for(var n=0;n<t.length-1;n++)if(jsonOdm.Geo.edgeIntersectsEdge(o,[t[n],t[n+1]],!1))return!1;return!0},jsonOdm.Geo.edgeIntersectsEdge=function(o,t,n){n="undefined"==typeof n?!0:n;var e=[o[1][0]-o[0][0],o[1][1]-o[0][1]],r=[Math.min(o[0][0],o[1][0]),Math.min(o[0][1],o[1][1]),Math.max(o[0][0],o[1][0]),Math.max(o[0][1],o[1][1])],i=[t[1][0]-t[0][0],t[1][1]-t[0][1]],s=[Math.min(t[0][0],t[1][0]),Math.min(t[0][1],t[1][1]),Math.max(t[0][0],t[1][0]),Math.max(t[0][1],t[1][1])];if(r[0]>s[0]&&r[0]>s[2]||r[1]>s[1]&&r[1]>s[3]||s[0]>r[0]&&s[0]>r[2]||s[1]>r[1]&&s[1]>r[3])return!1;if(i[0]*e[1]-e[0]*i[1]==0)return n&&o[0][1]+(t[0][0]-o[0][0])/e[0]*e[1]==t[0][1];var u=(o[0][0]*i[1]-t[0][0]*i[1]-o[0][1]*i[0])/(e[1]*i[0]-e[0]*i[1]),d=o[0][0]+u*e[0],c=o[0][1]+u*e[1];return n?d>=r[0]&&d<=r[2]&&c>=r[1]&&c<=r[3]:d>r[0]&&d<r[2]&&c>r[1]&&c<r[3]},jsonOdm.Geo.pointWithinLineString=function(o,t){if(!(jsonOdm.util.isArray(o)&&jsonOdm.util.isArray(t)&&t.length>=2))return!1;for(var n=0;n<t.length-1;n++)if((o[0]>=t[n][0]&&o[0]<=t[n+1][0]&&t[n][0]<=t[n+1][0]||o[0]<=t[n][0]&&o[0]>=t[n+1][0]&&t[n][0]>=t[n+1][0])&&(o[1]>=t[n][1]&&o[1]<=t[n+1][1]&&t[n][1]<=t[n+1][1]||o[1]<=t[n][1]&&o[1]>=t[n+1][1]&&t[n][1]>=t[n+1][1])&&(t[n][0]==o[0]&&t[n][1]==o[1]||t[n+1][0]==o[0]&&t[n+1][1]==o[1]||t[n][1]-t[n+1][1]!=0&&(t[n][0]-t[n+1][0])*((o[1]-t[n+1][1])/(t[n][1]-t[n+1][1]))+t[n+1][0]==o[0]||t[n][0]-t[n+1][0]!=0&&(t[n][1]-t[n+1][1])*((o[0]-t[n+1][0])/(t[n][0]-t[n+1][0]))+t[n+1][1]==o[1]))return!0;return!1},jsonOdm.Geo.pointWithinBounds=function(o,t){return jsonOdm.util.isArray(o)&&jsonOdm.util.isArray(t)&&4==t.length?o[0]>=t[0]&&o[1]>=t[1]&&o[0]<=t[2]&&o[1]<=t[3]:!1},jsonOdm.Geo.lineStringWithinLineString=function(o,t){if(!jsonOdm.util.isArray(o)||!jsonOdm.util.isArray(t))return!1;var n,e;for(n=0;o&&n<o.length;n++){var r=!1;for(e=0;t&&e<t.length;e++)if(o[n][0]==t[e][0]&&o[n][1]==t[e][1]){if(n+1==o.length)return!0;if(!(t[e+1]&&o[n+1][0]==t[e+1][0]&&o[n+1][1]==t[e+1][1]||o[n+1][0]==t[e][0]&&o[n+1][1]==t[e][1]||e>0&&o[n+1][0]==t[e-1][0]&&o[n+1][1]==t[e-1][1]))return!1;r=!0}if(!r)return!1}return!0},jsonOdm.Collection=function(o){var t=Object.create(Array.prototype);return t=Array.apply(t)||t,"undefined"!=typeof o&&jsonOdm.selectedSource&&jsonOdm.selectedSource[o]&&(t=t.concat(jsonOdm.selectedSource[o])),jsonOdm.Collection.decorate(t),t.$branch=function(){var o=jsonOdm.util.branch(t,arguments);return jsonOdm.Collection.decorate(o),o},t},jsonOdm.Collection.decorate=function(o){var t=function(o){jsonOdm.util.isArray(o)&&(o.$hasMany=function(t,n,e,r){"string"==typeof e&&(r=r||e);var i=e;"string"==typeof e&&jsonOdm.selectedSource&&jsonOdm.selectedSource[e]&&(i=jsonOdm.selectedSource[e]);for(var s=0;s<o.length;s++){var u=t;if(o[s].hasOwnProperty(t)&&(u=o[s][t]),"undefined"==typeof o[s][r])for(var d=0;u.length&&d<u.length;d++){for(var c=null,l=0;l<i.length;l++)if(u[d]==i[l][n]){c=i[l];break}null!=c&&(o[s][r]||(o[s][r]=[]),o[s][r].push(c))}}},o.$hasOne=function(t,n,e,r){"string"==typeof e&&(r=r||e);var i=e;"string"==typeof e&&jsonOdm.selectedSource&&jsonOdm.selectedSource[e]&&(i=jsonOdm.selectedSource[e]);for(var s=0;s<o.length;s++){var u;if(o[s].hasOwnProperty(t)&&(u=o[s][t]),"undefined"==typeof o[s][r]){for(var d=null,c=0;c<i.length;c++)if(u==i[c][n]){d=i[c];break}null!=d&&(o[s][r]=d)}}},o.$query=function(){return new jsonOdm.Query(o)})};t(o)},jsonOdm.Query=function(o){this.$$commandQueue=[],this.$$collection=o},jsonOdm.Query.prototype.$delete=function(){if(this.$$commandQueue.length<1)return this;for(var o=0;o<this.$$collection.length;){for(var t=!0,n=0;n<this.$$commandQueue.length&&(t=t&&this.$$commandQueue[n](this.$$collection[o]));n++);t?this.$$collection.splice(o,1):o++}return this},jsonOdm.Query.prototype.$all=function(o){if(this.$$commandQueue.length<1)return this.$$collection;for(var t=new jsonOdm.Collection,n=0;n<this.$$collection.length;n++){for(var e=!0,r=0;r<this.$$commandQueue.length&&(e=e&&this.$$commandQueue[r](this.$$collection[n]));r++);if(e){if(o)return this.$$collection[n];t.push(this.$$collection[n])}}return t},jsonOdm.Query.prototype.$first=function(){return this.$all(!0)},jsonOdm.Query.prototype.$testCollection=function(o,t){var n=this.$$commandQueue.pop(),e=function(){return function(e){if(!(n instanceof jsonOdm.Collection||"function"==typeof n)||"function"!=typeof t)return!1;var r=n instanceof jsonOdm.Collection?n:n(e);return t(r,o)}}();return this.$$commandQueue.push(e),this},jsonOdm.Query.prototype.$binaryOperator=function(o,t){var n=function(o,n){return function(e){if("function"!=typeof n)return!1;for(var r=[],i=0;i<o.length;i++)for(var s=0;s<o[i].$$commandQueue.length;s++)r.push(o[i].$$commandQueue[s](e));return t(r)}}(o,t),e=new jsonOdm.Query(this.$$collection);return e.$$commandQueue.push(n),e},jsonOdm.Query.prototype.$branch=function(){var o=function(o){return function(t){return jsonOdm.util.branch(t,o)}}(arguments),t=new jsonOdm.Query(this.$$collection);return t.$$commandQueue.push(o),t},jsonOdm.Query.prototype.$eq=function(){return this.$testCollection(arguments,function(o,t){return Array.prototype.indexOf.call(t,o)>-1})},jsonOdm.Query.prototype.$in=function(o){return this.$testCollection(o,function(o,t){return Array.prototype.indexOf.call(t,o)>-1})},jsonOdm.Query.prototype.$ne=function(){return this.$testCollection(arguments,function(o,t){return-1==Array.prototype.indexOf.call(t,o)})},jsonOdm.Query.prototype.$nin=function(o){return this.$testCollection(o,function(o,t){return-1==Array.prototype.indexOf.call(t,o)})},jsonOdm.Query.prototype.$gt=function(o){return this.$testCollection(o,function(o,t){return o>t})},jsonOdm.Query.prototype.$gte=function(o){return this.$testCollection(o,function(o,t){return o>=t})},jsonOdm.Query.prototype.$lt=function(o){return this.$testCollection(o,function(o,t){return t>o})},jsonOdm.Query.prototype.$lte=function(o){return this.$testCollection(o,function(o,t){return t>=o})},jsonOdm.Query.prototype.$isNull=function(){return this.$testCollection(null,function(o){return"undefined"==typeof o||null===o})},jsonOdm.Query.prototype.$exists=function(){return this.$testCollection(null,function(o){return"undefined"!=typeof o})},jsonOdm.Query.prototype.$type=function(){return this.$testCollection(arguments,function(o,t){return jsonOdm.util.is(o,t)})},jsonOdm.Query.prototype.$mod=function(){return this.$testCollection(arguments,function(o,t){return o%t[0]==t[1]})},jsonOdm.Query.prototype.$regex=function(o,t){return"string"==typeof o&&(o="string"==typeof t?new RegExp(o,t):new RegExp(o)),this.$testCollection(o,function(o,t){return t.test(o)})},jsonOdm.Query.prototype.$geoWithin=function(o){return this.$testCollection(jsonOdm.Geo.detectAsGeometry(o),function(o,t){return json.Geo[o.type]&&json.Geo[o.type].within&&json.Geo[o.type].within(o,t)})},jsonOdm.Query.prototype.$and=function(){return this.$binaryOperator(arguments,function(o){for(var t=0;t<o.length;t++)if(!o[t])return!1;return!0})},jsonOdm.Query.prototype.$nand=function(){return this.$binaryOperator(arguments,function(o){for(var t=0;t<o.length;t++)if(!o[t])return!0;return!1})},jsonOdm.Query.prototype.$not=jsonOdm.Query.prototype.$nand,jsonOdm.Query.prototype.$or=function(){return this.$binaryOperator(arguments,function(o){for(var t=0;t<o.length;t++)if(o[t])return!0;return!1})},jsonOdm.Query.prototype.$nor=function(){return this.$binaryOperator(arguments,function(o){for(var t=0;t<o.length;t++)if(o[t])return!1;return!0})};